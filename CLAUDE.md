# CLAUDE.md

## Package Manager

Use **pnpm** (not npm/yarn) for all commands: `pnpm install`, `pnpm run dev`, `pnpm run build`, etc.

## Plans

Save all design docs and implementation plans to `plans/` at the repo root. This directory is gitignored.

## Auto-Generated Files (Do NOT commit)

The following files are auto-generated and gitignored. Never `git add -f` them:

- `frontend/helpers/blog.json` — generated from blog markdown frontmatter
- `sitemap*.xml`, `robots.txt` — generated by Next.js build
- `next-env.d.ts`, `*.tsbuildinfo` — TypeScript build artifacts

## Tech Stack

Next.js 14 (Pages Router, static export) · React 18 · TypeScript · Tailwind CSS · D3.js charts · Axios (GitHub API)

## Project Structure

All frontend code lives under `frontend/`.

| Directory | Purpose |
|-----------|---------|
| `pages/` | Next.js page routes (Pages Router) |
| `components/` | React UI components |
| `store/` | React Context state management with URL hash sync |
| `shared/common/` | GitHub API client (`api.tsx`) and chart data logic (`chart.tsx`) |
| `shared/packages/` | D3 chart implementation (`xy-chart.tsx`) |
| `shared/types/` | TypeScript type definitions |
| `helpers/` | Utilities (storage, toast, formatting, constants) and static data JSON |
| `styles/` | Tailwind config, global CSS, fonts |
| `server/` | LRU cache for repo star data |
| `scripts/` | Blog JSON generation script |
| `public/` | Static assets |

## Routes

Next.js **Pages Router** with `output: "export"` (static site generation).

| Route | File (`frontend/pages/`) | Description |
|-------|--------------------------|-------------|
| `/` | `index.tsx` | Home — chart viewer with repo input, sidebars |
| `/blog` | `blog/index.tsx` | Blog listing page |
| `/blog/[slug]` | `blog/[slug].tsx` | Individual blog post (markdown-based) |
| `/:owner/:repo` | `[...slug].tsx` | Repository detail page (catch-all) |
| 404 | `404.tsx` | Custom 404 with context-aware messages |

Layout wrappers: `_app.tsx` (per-page `getLayout` pattern), `_document.tsx`.

## State & Data Flow

1. **URL hash** (`#repo1&repo2&type=date&logscale`) → parsed in `store/index.tsx`
2. `RepoInputer` manages repo list → triggers `StarChartViewer`
3. `shared/common/api.tsx` fetches star history from GitHub API (with pagination & token auth)
4. `shared/common/chart.tsx` transforms data to D3-compatible format
5. `shared/packages/xy-chart.tsx` renders the SVG chart via D3

## Key Files for Common Changes

- **Chart rendering**: `shared/packages/xy-chart.tsx`, `components/StarChartViewer.tsx`, `components/Charts/StarXYChart.tsx`
- **GitHub API**: `shared/common/api.tsx`
- **State management**: `store/index.tsx`
- **Repo detail page**: `pages/[...slug].tsx`, `components/PageShell.tsx`
- **Blog system**: `pages/blog/[slug].tsx`, `scripts/generateBlogJson.mts`
- **Layout & nav**: `components/header.tsx`, `components/footer.tsx`, `components/LeftSidebar.tsx`, `components/RightSidebar.tsx`
- **Styling**: `tailwind.config.js`, `styles/global.css`
